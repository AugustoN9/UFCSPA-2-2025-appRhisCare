<!-- O Header agora recebe o tema e emite um evento (themeChange) quando ele é alterado -->
<app-header [theme]="theme()" (themeChange)="onThemeChange($event)"></app-header>

<main 
  [class]="theme() === 'dark' ? 'bg-dark text-white' : 'bg-light text-dark'" 
  class="app-main d-flex flex-column align-items-center justify-content-center p-3 transition-colors">
  
  <div 
    class="card shadow-lg overflow-hidden"
    [class]="theme() === 'dark' ? 'bg-dark border-secondary' : 'bg-body border-secondary-subtle'" 
    style="width: 100%; max-width: 960px;">
    <div class="row g-0">
      
      <!-- Coluna da Imagem -->
      <div class="col-lg-5">
        <div class="image-display-container position-relative">
          <img src="https://images.unsplash.com/photo-1534430480872-3498386e7856?q=80&w=1964&auto-format&fit=crop" class="w-100 h-100 object-fit-cover" alt="Imagem de uma cidade brasileira">
          <div class="position-absolute top-0 start-0 w-100 h-100" style="background: linear-gradient(to top, rgba(0,0,0,0.5), rgba(0,0,0,0.1));"></div>
        </div>
      </div>

      <!-- Coluna do Conteúdo -->
      <div class="col-lg-7 d-flex flex-column">
        <div class="card-body p-4 p-md-5 position-relative flex-grow-1 d-flex flex-column">

          <!-- Título -->
          <div class="text-center mb-4">
            <h1 class="h3 fw-bold text-info">Clima e Ar no Brasil</h1>
            <p [class]="theme() === 'dark' ? 'text-white-50' : 'text-body-secondary'">Pesquise o nome de uma cidade</p>
          </div>

          <!-- Formulário de Busca -->
          <div class="d-flex flex-column gap-3 mb-4">
            <div>
              <label for="city" class="form-label small">Cidade</label>
              <div class="input-group">
                <input
                  id="city"
                  type="text"
                  placeholder="Ex: Rio de Janeiro"
                  [class]="theme() === 'dark' ? 'form-control form-control-lg bg-dark text-white border-secondary' : 'form-control form-control-lg bg-body text-dark border-secondary-subtle'"
                  [(ngModel)]="city"
                  (keyup.enter)="search()"
                />
                <button
                  (click)="search()"
                  [disabled]="isLoading()"
                  class="btn btn-info btn-lg">
                  @if (isLoading()) {
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                  } @else {
                    <i class="bi bi-search"></i>
                  }
                </button>
              </div>
            </div>
          </div>

          <!-- Exibição de Erro e Resultados -->
          @if (errorMessage()) {
            <div class="alert alert-danger text-center" role="alert">
              <strong class="d-block">Ocorreu um erro:</strong>
              <span>{{ errorMessage() }}</span>
            </div>
          }
          
          @if (weatherData(); as weather) {
            <div class="d-flex flex-column gap-4 mt-auto animate-fade-in">

              <!-- Card de Clima -->
              <div [class]="theme() === 'dark' ? 'card text-light bg-secondary bg-opacity-10 border-secondary' : 'card bg-light bg-opacity-75 border-secondary-subtle'">
                <div class="card-body text-center">
                  <h2 class="card-title h4">{{ weather.name }}</h2>
                  <div class="d-flex align-items-center justify-content-around my-3">
                    <div>
                      <i [class]="getWeatherIconClass(weather.weather[0].icon)"></i>
                      <p class="text-capitalize mt-2 mb-0">{{ weather.weather[0].description }}</p>
                    </div>
                    <div class="display-4 fw-bold">
                      {{ weather.main.temp.toFixed(1) }}°C
                    </div>
                  </div>
                  <div class="d-flex justify-content-around small" [class.text-white-50]="theme() === 'dark'" [class.text-body-secondary]="theme() === 'light'">
                    <span>Sensação: {{ weather.main.feels_like.toFixed(1) }}°C</span>
                    <span>Umidade: {{ weather.main.humidity }}%</span>
                    <span>Vento: {{ weather.wind.speed }} m/s</span>
                  </div>
                </div>
              </div>

              <!-- Card de Poluição do Ar -->
              @if(airPollutionData(); as air) {
                <div [class]="theme() === 'dark' ? 'card text-light bg-secondary bg-opacity-10 border-secondary' : 'card bg-light bg-opacity-75 border-secondary-subtle'">
                   <div class="card-body">
                      <h3 class="card-title text-center h5 mb-3">Qualidade do Ar</h3>
                      <div class="text-center mb-3">
                        <p class="display-6 fw-bold mb-0" [class]="getAqiColor(air.list[0].main.aqi)">
                          {{ getAqiDescription(air.list[0].main.aqi) }}
                        </p>
                        <p class="small" [class.text-white-50]="theme() === 'dark'" [class.text-body-secondary]="theme() === 'light'">(Índice: {{ air.list[0].main.aqi }})</p>
                      </div>
                      <div class="row g-2 text-center small">
                          <div class="col-6 col-md-4"><div [class]="theme() === 'dark' ? 'bg-dark rounded p-2' : 'bg-dark-subtle rounded p-2'"><span [class.text-white-50]="theme() === 'dark'" [class.text-body-secondary]="theme() === 'light'">CO:</span> {{ air.list[0].components.co.toFixed(2) }}</div></div>
                          <div class="col-6 col-md-4"><div [class]="theme() === 'dark' ? 'bg-dark rounded p-2' : 'bg-dark-subtle rounded p-2'"><span [class.text-white-50]="theme() === 'dark'" [class.text-body-secondary]="theme() === 'light'">NO₂:</span> {{ air.list[0].components.no2.toFixed(2) }}</div></div>
                          <div class="col-6 col-md-4"><div [class]="theme() === 'dark' ? 'bg-dark rounded p-2' : 'bg-dark-subtle rounded p-2'"><span [class.text-white-50]="theme() === 'dark'" [class.text-body-secondary]="theme() === 'light'">O₃:</span> {{ air.list[0].components.o3.toFixed(2) }}</div></div>
                          <div class="col-6 col-md-4"><div [class]="theme() === 'dark' ? 'bg-dark rounded p-2' : 'bg-dark-subtle rounded p-2'"><span [class.text-white-50]="theme() === 'dark'" [class.text-body-secondary]="theme() === 'light'">SO₂:</span> {{ air.list[0].components.so2.toFixed(2) }}</div></div>
                          <div class="col-12 col-md-4"><div [class]="theme() === 'dark' ? 'bg-dark rounded p-2' : 'bg-dark-subtle rounded p-2'"><span [class.text-white-50]="theme() === 'dark'" [class.text-body-secondary]="theme() === 'light'">PM₂.₅:</span> {{ air.list[0].components.pm2_5.toFixed(2) }}</div></div>
                      </div>
                   </div>
                </div>
              }

            </div>
          }
        </div>
      </div>
    </div>
  </div>

   
</main>

<app-footer></app-footer>